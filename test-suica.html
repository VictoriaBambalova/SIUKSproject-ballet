<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <script src="suica.js"></script>
    <script src="tween.umd.js"></script>

    <title>Suica test</title>
  </head>
  <body>
    <suica background="whitesmoke" fullwindow>
      <proactive></proactive>

      <orbit></orbit>
      <!-- Torso -->
      <cone
        id="torsoUpper"
        center="0,15,0"
        size="10,15,10"
        color="#00b4d8"
        spinV="180"
      ></cone>

      <cone
        id="torsoLower"
        center="0,0,0"
        size="29,8,29"
        color="#0077b6"
      ></cone>

      <!-- Waist ring -->
      <sphere
        id="waistRing"
        center="0,7.5,0"
        size="6.5, 3, 6.5"
        color="#0077b6"
      ></sphere>
      <group id="headgroup">
        <sphere id="head" center="0,20,0" size="7" color="mistyrose"></sphere>

        <cylinder
          id="neck"
          center="0,13,0"
          size="2.5,5,2.5"
          color="mistyrose"
        ></cylinder>

        <!-- Hair: cap + bun -->
        <sphere
          id="hair"
          center="0,20.5,-0.3"
          size="7"
          color="saddlebrown"
          spin
        ></sphere>

        <sphere
          id="bun"
          center="0,23.5,-2.5"
          size="3.7"
          color="saddlebrown"
        ></sphere>
      </group>

      <!-- sssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssss
       ssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssss
       Shoulders: slightly closer to torso -->

      <!--TEMPLATES-->
      <sphere id="joint" size="3" color="mistyrose" hidden="true"></sphere>
      <cylinder
        id="bone"
        size="2.5,6,2.5"
        color="mistyrose"
        hidden="true"
      ></cylinder>
      <!--TEMPLATES-->

      <!-- ARMS (both together) -->
      <group id="ArmsGroup" center="0,4,-10" hidden="false" spinV="45">
        <!-- LEFT ARM (as it was) -->
        <group
          id="ShoulderGroup"
          center="-1.5,8,-11"
          spinH="10"
          spinV="60"
          hidden="false"
        >
          <clone
            src="joint"
            id="lShoulder"
            center="5,14,0"
            hidden="false"
          ></clone>

          <clone
            src="bone"
            id="lUpperArm"
            center="5,14,0"
            size="2.5,6,2.5"
            hidden="false"
          ></clone>

          <group
            id="ElbowGroup"
            center="13.5,2,-5"
            spinH="-90"
            spinV="25"
            hidden="false"
          >
            <clone
              src="joint"
              id="lElbow"
              center="5,20,0"
              size="2.8"
              hidden="false"
            ></clone>

            <clone
              src="bone"
              id="lLowerArm"
              center="5,20,0"
              size="2.5,6,2.5"
              hidden="false"
            ></clone>

            <clone
              src="joint"
              id="wrist"
              center="5,26,0"
              size="3,5"
              spinV="40"
              spinH="-90"
              hidden="false"
            ></clone>
          </group>
        </group>
        <!-- LEFT ARM -->

        <!-- RIGHT ARM (mirror of left) -->
        <group
          id="RightShoulderGroup"
          center="1.5,8,-11"
          spinH="-10"
          spinV="60"
          hidden="false"
        >
          <clone
            src="joint"
            id="rShoulder"
            center="-5,14,0"
            hidden="false"
          ></clone>

          <clone
            src="bone"
            id="rUpperArm"
            center="-5,14,0"
            size="2.5,6,2.5"
            hidden="false"
          ></clone>

          <group
            id="RightElbowGroup"
            center="-13.5,2,-5"
            spinH="90"
            spinV="25"
            hidden="false"
          >
            <clone
              src="joint"
              id="rElbow"
              center="-5,20,0"
              size="2.8"
              hidden="false"
            ></clone>

            <clone
              src="bone"
              id="rLowerArm"
              center="-5,20,0"
              size="2.5,6,2.5"
              hidden="false"
            ></clone>

            <clone
              src="joint"
              id="rWrist"
              center="-5,26,0"
              size="3,5"
              spinV="40"
              spinH="90"
              hidden="false"
            ></clone>
          </group>
        </group>
        <!-- RIGHT ARM -->
      </group>
      <!-- ARMS -->

      <!-- LEGS -->
      <group id="LegsGroup" center="0,0,0" hidden="false">
        <!-- LEFT LEG -->
        <group id="LeftHipGroup" center="-2.5,0,0" hidden="false">
          <!-- Thigh (upper leg) -->

          <clone
            src="bone"
            id="lCalf"
            center="0,-9,0"
            size="3.5,12,3.5"
            hidden="false"
          ></clone>
          <!-- Knee gr
           oup (pivot at knee) -->
          <group id="LeftKneeGroup" center="0,-9,0" hidden="false">
            <!-- Knee joint -->
            <clone src="joint" id="lKnee" size="3.8" hidden="false"></clone>

            <!-- Calf (lower leg) -->
            <clone
              src="bone"
              id="lCalf"
              center="0,-10,0"
              size="3,9,3"
              hidden="false"
            ></clone>

            <!-- Foot (spheroids) -->
            <group id="shoe" spinH="-90">
              <sphere
                id="lFoot"
                center="0,-10,0"
                size="3.5,2,3.5"
                color="#0077b6"
              ></sphere>

              <sphere
                id="lFoot"
                center="0,-10,2"
                size="3,2,7"
                color="#0077b6"
              ></sphere>
            </group>
          </group>
        </group>
        <!-- LEFT LEG -->

        <!-- RIGHT LEG (mirror) -->
        <!-- RIGHT LEG -->
        <group id="RightHipGroup" center="2.5,0,0" hidden="false">
          <!-- Thigh (upper leg) -->

          <clone
            src="bone"
            id="rCalf"
            center="0,-9,0"
            size="3.5,12,3.5"
            hidden="false"
          ></clone>

          <!-- Knee group (pivot at knee) -->
          <group id="RightKneeGroup" center="0,-9,0" hidden="false">
            <!-- Knee joint -->
            <clone src="joint" id="rKnee" size="3.8" hidden="false"></clone>

            <!-- Calf (lower leg) -->
            <clone
              src="bone"
              id="rCalfLower"
              center="0,-10,0"
              size="3,9,3"
              hidden="false"
            ></clone>

            <!-- Foot (spheroids) -->
            <group id="rShoe" spinH="90">
              <sphere
                id="rFoot"
                center="0,-10,0"
                size="3.5,2,3.5"
                color="#0077b6"
              ></sphere>

              <sphere
                id="rFootTip"
                center="0,-10,2"
                size="3,2,7"
                color="#0077b6"
              ></sphere>
            </group>
          </group>
        </group>
        <!-- RIGHT LEG -->

        <!-- RIGHT LEG -->
      </group>
      <!-- LEGS -->
    </suica>

    <script>
      // засиняваща функция
      function bluish(object) {
        object.color = hsl(random(180, 225), 70, 50);
        return object;
      }

      bluish(torsoUpper);
      bluish(torsoLower);

      // пачка от 500 цилиндъра
      n = 500;

      for (var i = 0; i < n; i++) {
        // положение на цилиндър
        alpha = radians((360 * i) / n);
        center = [3 * Math.cos(alpha), 1, 3 * Math.sin(alpha)];

        // създаване на синкав цилиндър
        a = bluish(cylinder(center, [1, 15]));
        a.spinH = 90 + degrees(-alpha);
        a.spinV = 90 + 15 * Math.sin(6 * alpha);
      }

      for (var i = 0; i < n; i++) {
        // положение на цилиндър
        alpha = radians((360 * i) / n);
        center = [1.5 * Math.cos(alpha), 4, 1.5 * Math.sin(alpha)];

        // създаване на синкав цилиндър
        a = bluish(cylinder(center, [1, 15]));
        a.spinH = 90 + degrees(-alpha);
        a.spinV = 90 + 15 * Math.sin(6 * alpha);
      }

      for (var i = 0; i < n; i++) {
        // положение на цилиндър
        alpha = radians((360 * i) / n);
        center = [0.009 * Math.cos(alpha), 7, 0.009 * Math.sin(alpha)];

        // създаване на синкав цилиндър
        a = bluish(cylinder(center, [1, 15]));
        a.spinH = 90 + degrees(-alpha);
        a.spinV = 90 + 15 * Math.sin(6 * alpha);
      }

      //фуния за рамене и врат
      function funnel(u) {
        return [0, 40 * u - 20, 0, 30 / (11 - 10 * u)];
      }

      // няколко вложени фунии
      funnelDress = tube(
        [0, 18.4, 0],
        funnel,
        4,
        [40, 100],
        0.169,
        "mistyrose",
      );
      funnelDress.spinV = 180;

      // Пози за ръцете (в градуси)
      const ARM_POSES = {
        1: { shH: 0, shV: 20, elV: 25, wrV: 10 },
        2: { shH: 60, shV: 0, elV: 10, wrV: 0 },
        3: { shH: 40, shV: 50, elV: 20, wrV: 15 },
        4: { shH: 20, shV: 70, elV: 25, wrV: 20 },
        5: { shH: 0, shV: 90, elV: 15, wrV: 25 },
      };

      function goArms(pos, duration = 800) {
        const target = ARM_POSES[pos];
        if (!target) return;

        // спира предишен tween, ако има
        if (goArms._tween) goArms._tween.stop();

        const state = {
          shH: ShoulderGroup.spinH,
          shV: ShoulderGroup.spinV,
          elV: ElbowGroup.spinV,
          wrV: wrist.spinV,
        };

        goArms._tween = new TWEEN.Tween(state)
          .to(target, duration)
          .easing(TWEEN.Easing.Quadratic.InOut)
          .onUpdate(() => {
            ShoulderGroup.spinH = state.shH;
            ShoulderGroup.spinV = state.shV;
            ElbowGroup.spinV = state.elV;
            wrist.spinV = state.wrV;
          })
          .start();
      }

      // Това се вика всеки кадър (само ако имаш proactive)
      suica.onTime = function (t, dt) {
        TWEEN.update(t);
      };

      // Тест: сменя пози на 1.5 секунди
      window.addEventListener("load", () => {
        console.log("ShoulderGroup:", ShoulderGroup);
        console.log("ElbowGroup:", ElbowGroup);
        console.log("wrist:", wrist);

        let testPose = 1;
        goArms(1, 0);

        setInterval(() => {
          testPose++;
          if (testPose > 5) testPose = 1;
          goArms(testPose);
        }, 1500);
      });
    </script>
  </body>
</html>
